{{ define "index" }}
{{ template "header" }}

<div id="order-list" style="display: none" >
        <div id="orders"></div>
<div>
<script type="text/jsx">

var OrderBox = React.createClass({
    loadOrdersFromServer: function() {
        $.ajax({
            url: this.props.url,
            dataType: 'text',
            success: function(data) {
                this.setState({data: JSON.parse(data)});
                $("#preloader").css("display", "none");
                $("#order-list").css("display", "block");
            }.bind(this),
            error: function(xhr, status, err) {
                console.err(this.props.url, status, err.toString());
            }.bind(this)
        });
    },
    getInitialState: function() {
        return { data: [] };
    },
    componentDidMount: function() {
        this.loadOrdersFromServer();
        setInterval(this.loadOrdersFromServer,
        this.props.pollInterval)
    },
    render: function() {
        return (
            <div className="orderBox">
                <OrderList data = {this.state.data} />
            </div>
            );
    }
});
        

var OrderList = React.createClass({
render: function() {
    var orderNodes = this.props.data.map(function (order) {
        return (
            <Order  
                    OrderID = {order.OrderID}
                    Status = {order.Status}
                    InsertDate = {order.InsertDate}
                    CarNum = {order.CarNum}
                    Name = {order.Name}
                    StCode = {order.StCode}
                    >
            </Order>
        );
    });

    return(
        <table className="hoverTable OrderList table table-bordered">
            <tr>
                <th>Order ID</th>
                <th>Insert Date</th>
                <th>Status</th>
                <th>Name</th>
                <th>Car Number</th>
            </tr>
            {orderNodes}
        </table>
    );
}
});


var Order = React.createClass({
    render: function(){
        var stImgURL = "/assets/img/" + 
                        this.props.StCode +
                        ".png";
        return(
        <tr>
            <td className="order-id">
                    {this.props.OrderID}
            </td>
            <td className="order-id">
                    {this.props.InsertDate}
            </td>
            <td className="order-id">
                    <img src={stImgURL}/> <span>{this.props.Status}</span>
            </td>
            <td className="order-id">
                    {this.props.Name}
            </td>
            <td className="order-id">
                    {this.props.CarNum}
            </td>
        </tr>
        );
    }
});
React.render(
        {{ $fleet := . }}
        <OrderBox url="/active-logs?fleet={{ $fleet }}" pollInterval={2000} />, 
        document.getElementById('orders')
);
</script>
</body>
</html>
{{ end }}
